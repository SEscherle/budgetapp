# Arctic Budget - QA Testing Instructions

## Overview

This project contains QA assets for the **Arctic Budget** web application (envelope budgeting app, Angular 21 + Firebase). Tests run against the QA environment at `https://arctic-budget-qa.web.app/`.

## Project Structure

```
budget-app/
├── .claude.md                          ← This file
├── playwright.config.ts                ← Playwright configuration
├── package.json
├── source/                             ← PRD and QA reference docs
│   ├── PRD.md
│   ├── QA_URL.xlsx
│   └── Test users.xlsx
├── docs/qa/
│   ├── checklist.md                    ← Manual QA checklist (156 test cases)
│   └── a11y-approach.md                ← Accessibility testing approach & limitations
├── tests/
│   ├── fixtures/
│   │   └── auth.fixture.ts             ← Auth fixture with storage-state caching
│   ├── pages/
│   │   ├── login.page.ts               ← LoginPage POM
│   │   └── budget.page.ts              ← BudgetPage POM
│   ├── helpers/
│   │   └── a11y.helper.ts              ← axe-core wrapper for a11y assertions
│   ├── system/
│   │   ├── budget-app.system.spec.ts   ← System tests (15 tests, @system)
│   │   └── accessibility.spec.ts       ← A11y scans (4 tests, @system)
│   └── integration/
│       └── budget-app.integration.spec.ts  ← Integration tests (10 tests, @integration)
└── tests/.auth/                        ← Cached auth state (gitignored)
```

## How to Run Tests

```bash
# All 29 tests
npx playwright test

# System tests only (19 tests)
npx playwright test --grep @system

# Integration tests only (10 tests)
npx playwright test --grep @integration

# A specific test file
npx playwright test tests/system/accessibility.spec.ts

# With UI mode (interactive debugging)
npx playwright test --ui

# With headed browser (watch tests run)
npx playwright test --headed

# Override target URL
BASE_URL=https://localhost:4200 npx playwright test
```

## Test Credentials

| User | Email | Password |
|------|-------|----------|
| Primary | `qa-primary@arcticbudget.test` | `QaTest123!` |
| Secondary | `qa-secondary@arcticbudget.test` | `QaTest123!` |

Override via env vars: `QA_PRIMARY_EMAIL`, `QA_PRIMARY_PASSWORD`, `QA_SECONDARY_EMAIL`, `QA_SECONDARY_PASSWORD`.

## What to Look at When Failures Happen

### 1. Test Report
```bash
npx playwright show-report
```
Opens the HTML report with screenshots, traces, and error details.

### 2. Trace Viewer (on retries)
Traces are captured on first retry. Open them from the HTML report or:
```bash
npx playwright show-trace test-results/<test-name>/trace.zip
```

### 3. Screenshots
Failure screenshots are saved to `test-results/`. Visual regression baselines are in `tests/**/*.spec.ts-snapshots/`.

### 4. Common Failure Patterns

| Symptom | Likely Cause | Action |
|---------|-------------|--------|
| All auth tests fail | QA environment down or credentials changed | Check `https://arctic-budget-qa.web.app/` manually; verify test user creds |
| `waitForURL` timeout | App redirected unexpectedly (e.g., to budget-select) | Check if budget selection is required; update URL patterns |
| Locator not found | UI changed (class names, labels, structure) | Update selectors in page objects or test; prefer role/text selectors |
| Visual regression diff | Intentional UI change | Update baselines: `npx playwright test --update-snapshots` |
| axe-core violations | Accessibility regression | Read the violation summary; check `docs/qa/a11y-approach.md` for guidance |
| `test.skip` triggered | QA env missing expected data/UI elements | Seed QA data or adjust test expectations |

### 5. Stale Auth Cache
If tests fail with auth issues after working previously:
```bash
rm -rf tests/.auth/
npx playwright test
```

## Test Design Principles

- **Stable selectors**: `getByRole`, `getByText`, `getByLabel`, `getByTestId` - no fragile CSS selectors
- **Locators re-resolve**: All locators are Playwright locators (auto-retry, re-resolve at action time)
- **Graceful skips**: Tests skip (`test.skip`) when QA env doesn't support an operation, rather than failing
- **Soft assertions**: Non-critical checks use `expect.soft()` so one failure doesn't mask others
- **Tagged suites**: `@system` and `@integration` in describe blocks for selective runs
- **Page Object Model**: Only for LoginPage and BudgetPage (most reused); other tests use inline locators

## Adding New Tests

1. Put system-level tests in `tests/system/`, integration tests in `tests/integration/`
2. Tag your describe block: `test.describe('My Feature @system', ...)`
3. Import auth fixture: `import { test, expect } from '../fixtures/auth.fixture'`
4. Use `authenticatedPage` fixture for tests that need a logged-in user
5. For a11y checks, import the helper: `import { checkA11y } from '../helpers/a11y.helper'`
